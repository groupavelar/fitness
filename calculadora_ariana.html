<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Calorias</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { margin: 0; padding: 0; background-color: #fff0f6; color: #880e4f; }
    header { background-color: #c2185b; color: white; padding: 1rem; text-align: center; font-size: 1.5rem; font-weight: bold; }
    .container { max-width: 700px; margin: auto; padding: 1rem; }
    .meal-section { margin-bottom: 2rem; }
    .meal-title { font-weight: bold; font-size: 1.1rem; margin: 1rem 0 0.5rem; }
    .input-row { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
    input, select, button { padding: 0.6rem; font-size: 0.95rem; width: 100%; }
    select { -webkit-appearance: none; }
    button { background-color: #ec407a; color: white; border: none; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    th, td { border: 1px solid #f8bbd0; padding: 0.5rem; text-align: left; font-size: 0.9rem; }
    tfoot { font-weight: bold; background-color: #fce4ec; }
    .total-diario { font-size: 1.2rem; font-weight: bold; margin-top: 1.5rem; text-align: center; }
    #chart-container { margin-top: 2rem; }
    #graficoCalorias { height: 300px !important; }
    .btn-remove { background: transparent; color: red; cursor: pointer; border: none; font-size: 1rem; }
  </style>
</head>
<body>
  <header>
    Calculadora de Calorias â€“ <span id="user-name">Ariana Mendes</span>
  </header>
  <div class="container" id="main"></div>
  <div class="total-diario">
    Total DiÃ¡rio: <span id="total-dia">0 kcal</span>
    <br>
    <button onclick="salvarDia()">Salvar Dia</button>
  </div>
  <div id="chart-container" class="container">
    <canvas id="graficoCalorias"></canvas>
    <br>
    <button onclick="resetarGrafico()">Resetar GrÃ¡fico</button>
  </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const nomeUsuario = "Ariana Mendes";
  document.getElementById("user-name").textContent = nomeUsuario;

  const alimentos = {
    "ğŸ¥˜ Arroz branco cozido": 1.29,
    "ğŸ¥˜ Arroz integral cozido": 1.11,
    "ğŸ¥˜ Batata frita": 3.12,
    "ğŸ¥˜ Batata frita na air fryer": 1.70,
    "ğŸ¥˜ Bacon": 3.93,
    "ğŸ¥˜ Carne de frango": 1.65,
    "ğŸ¥˜ Carne MoÃ­da patinho": 1.40,
    "ğŸ¥˜ Carne bovina magra": 2.50,
    "ğŸ¥˜ Carne suÃ­na": 2.70,
    "ğŸ¥˜ Cuscuz": 1.12,
    "ğŸ¥˜ FeijÃ£o carioca cozido": 0.76,
    "ğŸ¥˜ FeijÃ£o preto cozido": 0.77,
    "ğŸ¥˜ Frango grelhado (peito)": 1.65,
    "ğŸ¥˜ GrÃ£o-de-bico cozido": 1.64,
    "ğŸ¥˜ HambÃºrguer bovino": 2.50,
    "ğŸ¥˜ Lentilha cozida": 1.16,
    "ğŸ¥˜ LinguiÃ§a calabresa": 2.80,
    "ğŸ¥˜ MacarrÃ£o cozido": 1.58,
    "ğŸ¥˜ MacarrÃ£o integral cozido": 1.24,
    "ğŸ¥˜ Nuggets de frango": 2.96,
    "ğŸ¥˜ Omelete": 1.54,
    "ğŸ¥˜ Ovo cozido": 0.68,
    "ğŸ¥˜ Ovo frito sem gordura": 0.96,
    "ğŸ¥˜ Peixe (tilÃ¡pia)": 1.28,
    "ğŸ¥˜ Pizza de muÃ§arela (1 fatia)": 2.66,
    "ğŸ¥˜ Pizza normal (1 fatia)": 2.85,
    "ğŸ¥˜ Queijo Minas padrÃ£o": 3.60,
    "ğŸ¥˜ Queijo minas frescal": 2.40,
    "ğŸ¥˜ Queijo muÃ§arela": 2.80,
    "ğŸ¥˜ Quinoa cozida": 1.20,
    "ğŸ¥˜ RequeijÃ£o": 2.57,
    "ğŸ¥˜ SalmÃ£o": 2.08,
    "ğŸ¥¬ Alface": 0.15,
    "ğŸ¥¬ Abobrinha": 0.17,
    "ğŸ¥¬ Beterraba": 0.43,
    "ğŸ¥¬ BrÃ³colis": 0.34,
    "ğŸ¥¬ Cenoura": 0.41,
    "ğŸ¥¬ Couve": 0.27,
    "ğŸ¥¬ Espinafre": 0.23,
    "ğŸ¥¬ Pepino": 0.16,
    "ğŸ¥¬ Repolho": 0.25,
    "ğŸ¥¬ Tomate": 0.18,
    "ğŸ Abacate": 1.60,
    "ğŸ Banana": 0.89,
    "ğŸ Kiwi": 0.61,
    "ğŸ Laranja": 0.47,
    "ğŸ MaÃ§Ã£": 0.52,
    "ğŸ MamÃ£o": 0.43,
    "ğŸ Melancia": 0.30,
    "ğŸ Morango": 0.32,
    "ğŸ Pera": 0.57,
    "ğŸ Uva": 0.69,
    "ğŸ AÃ§aÃ­ com xarope": 1.10,
    "ğŸ° Barra de cereal": 0.92,
    "ğŸ° Beijinho (1 unidade)": 0.85,
    "ğŸ° Bala de goma (5 unidades)": 0.85,
    "ğŸ° Biscoito recheado (3 unidades)": 1.80,
    "ğŸ° Bolo recheado": 3.50,
    "ğŸ° Bombom sortido (1 unidade)": 1.00,
    "ğŸ° Brigadeiro (1 unidade)": 0.90,
    "ğŸ° Chocolate ao leite (100g)": 5.35,
    "ğŸ° Nutella (1 colher sopa)": 1.00,
    "ğŸ° PaÃ§oca (1 unidade)": 0.90,
    "ğŸ° Pipoca de panela": 3.87,
    "ğŸ° Pudim": 2.53,
    "ğŸ° Sorvete (1 bola)": 1.30,
    "ğŸ§ƒ CafÃ© preto sem aÃ§Ãºcar (1 xÃ­cara)": 0.02,
    "ğŸ§ƒ CafÃ© com aÃ§Ãºcar (1 xÃ­cara)": 0.20,
    "ğŸ§ƒ Iogurte natural": 0.63,
    "ğŸ§ƒ Iogurte normal": 0.63,
    "ğŸ§ƒ Leite integral": 0.61,
    "ğŸ§ƒ Leite desnatado": 0.35,
    "ğŸ§ƒ Leite em pÃ³ integral (2 col. sopa)": 0.99,
    "ğŸ§ƒ Refrigerante (lata 350ml)": 1.40,
    "ğŸ§ƒ Suco de caixinha 100%": 0.42,
    "ğŸ§ƒ Suco de caixinha normal": 0.50,
    "ğŸ§ƒ Suco em pÃ³ (preparado)": 0.65,
    "ğŸ£ PÃ£o francÃªs": 1.40,
    "ğŸ£ PÃ£o integral": 1.10,
    "ğŸ£ Castanha-do-parÃ¡": 6.56,
    "ğŸ£ AmÃªndoas": 5.79,
    "ğŸ£ Nozes": 6.54,
    "ğŸ£ Amendoim": 5.67,
    "ğŸ£ Chia": 4.86,
    "ğŸ£ LinhaÃ§a": 5.34,
    "ğŸ£ Manteiga (1 colher sopa)": 1.02,
    "ğŸ£ Sushi cru (2 unidades)": 0.70,
    "ğŸ£ Sushi frito (2 unidades)": 1.10,
    "ğŸ£ Clara de ovo": 0.17,
    "ğŸ£ Aveia": 3.89
  };

  const refeicoes = [
    "CafÃ© da manhÃ£", "RefeiÃ§Ã£o pÃ³s cafÃ©", "AlmoÃ§o",
    "Lanche da tarde", "Jantar", "Ceia da noite"
  ];

  function normalizar(str) {
    return str.normalize("NFD").replace(/\p{Diacritic}/gu, "").replace(/\s+/g, "-");
  }

  const main = document.getElementById("main");
  let dadosHistorico = JSON.parse(localStorage.getItem("calorias-historico") || "[]");
  let dadosHoje = JSON.parse(localStorage.getItem("refeicoes-hoje") || "{}");

  window.adicionar = function(ref) {
    const id = normalizar(ref);
    const sel = document.getElementById(`sel-${id}`);
    const qtdInput = document.getElementById(`qtd-${id}`);
    const qtd = parseFloat(qtdInput.value);
    if (!qtd || qtd <= 0) return;
    const alim = sel.value;
    const kcal = alimentos[alim] * qtd;
    if (!dadosHoje[ref]) dadosHoje[ref] = [];
    dadosHoje[ref].push({ alim, qtd, kcal });
    localStorage.setItem("refeicoes-hoje", JSON.stringify(dadosHoje));
    atualizarTabela(ref);
    atualizarTotal();
    qtdInput.value = "";
  }

  window.removerItem = function(ref, index) {
    dadosHoje[ref].splice(index, 1);
    localStorage.setItem("refeicoes-hoje", JSON.stringify(dadosHoje));
    atualizarTabela(ref);
    atualizarTotal();
  }

  function atualizarTabela(ref) {
    const id = normalizar(ref);
    const tbody = document.querySelector(`#tab-${id} tbody`);
    if (!tbody) return;
    tbody.innerHTML = "";
    let total = 0;
    (dadosHoje[ref] || []).forEach((item, index) => {
      total += item.kcal;
      tbody.innerHTML += `<tr><td>${item.alim}</td><td>${item.qtd}</td><td>${item.kcal.toFixed(2)}</td><td><button class='btn-remove' onclick="removerItem('${ref}', ${index})">Ã—</button></td></tr>`;
    });
    const totalEl = document.getElementById(`total-${id}`);
    if (totalEl) totalEl.textContent = total.toFixed(2);
  }

  function atualizarTotal() {
    let total = 0;
    for (const ref in dadosHoje) {
      dadosHoje[ref].forEach(e => total += e.kcal);
    }
    document.getElementById("total-dia").textContent = total.toFixed(2) + " kcal";
  }

  window.salvarDia = function() {
    let total = 0;
    for (const ref in dadosHoje) {
      dadosHoje[ref].forEach(e => total += e.kcal);
    }
    const hoje = new Date().toISOString().split('T')[0];
    dadosHistorico.push({ dia: hoje, kcal: total });
    localStorage.setItem("calorias-historico", JSON.stringify(dadosHistorico));
    localStorage.removeItem("refeicoes-hoje");
    localStorage.setItem("ultima-salvaguarda", hoje);
    location.reload();
  }

  window.resetarGrafico = function() {
    if (confirm("Tem certeza que deseja apagar todo o histÃ³rico?")) {
      localStorage.removeItem("calorias-historico");
      location.reload();
    }
  }

  function desenharGrafico() {
    const ctx = document.getElementById('graficoCalorias').getContext('2d');
    const dias = dadosHistorico.map(e => e.dia);
    const valores = dadosHistorico.map(e => e.kcal);
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: dias,
        datasets: [{ label: 'Kcal consumidas', data: valores, backgroundColor: '#ff69b4' }]
      },
      options: {
        scales: { y: { beginAtZero: true } }
      }
    });
  }

  function salvarDiaAutomaticamenteSeForNovo() {
    const hoje = new Date().toISOString().split('T')[0];
    const salvo = localStorage.getItem("ultima-salvaguarda");
    if (salvo && salvo === hoje) return;
    salvarDia();
  }

  function checarViradaDoDia() {
    const agora = new Date();
    const proximaMeiaNoite = new Date();
    proximaMeiaNoite.setHours(24, 0, 0, 0);
    const tempoRestante = proximaMeiaNoite - agora;
    setTimeout(() => {
      salvarDiaAutomaticamenteSeForNovo();
      checarViradaDoDia();
    }, tempoRestante);
  }

  function renderizarRefeicoes() {
    refeicoes.forEach(ref => {
      const id = normalizar(ref);
      const sec = document.createElement('div');
      sec.className = 'meal-section';
      sec.innerHTML = `
        <div class="meal-title">${ref}</div>
        <div class="input-row">
          <select id="sel-${id}">
            ${Object.keys(alimentos).map(alim => `<option value="${alim}">${alim}</option>`).join('')}
          </select>
          <input id="qtd-${id}" type="number" min="0" step="0.1" placeholder="Qtd (100g)" />
          <button onclick="adicionar('${ref}')">Adicionar</button>
        </div>
        <table id="tab-${id}"><thead><tr><th>Alimento</th><th>Qtd</th><th>kcal</th><th></th></tr></thead><tbody></tbody><tfoot><tr><td colspan="2">Total</td><td id="total-${id}">0</td><td></td></tr></tfoot></table>
      `;
      main.appendChild(sec);
    });
  }

  renderizarRefeicoes();
  for (const ref in dadosHoje) atualizarTabela(ref);
  atualizarTotal();
  desenharGrafico();
  checarViradaDoDia();
});
</script>
</body>
</html>
