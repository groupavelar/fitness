<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Calorias</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { margin: 0; padding: 0; background-color: #fff0f5; color: #212529; }
    header { background-color: #ff69b4; color: white; padding: 1rem; text-align: center; font-size: 1.5rem; font-weight: bold; }
    .container { max-width: 700px; margin: auto; padding: 1rem; }
    .meal-section { margin-bottom: 2rem; }
    .meal-title { font-weight: bold; font-size: 1.1rem; margin: 1rem 0 0.5rem; }
    .input-row { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
    input, select, button { padding: 0.6rem; font-size: 0.95rem; width: 100%; }
    select { -webkit-appearance: none; }
    button { background-color: #ff69b4; color: white; border: none; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    th, td { border: 1px solid #dee2e6; padding: 0.5rem; text-align: left; font-size: 0.9rem; }
    tfoot { font-weight: bold; background-color: #f8bbd0; }
    .total-diario { font-size: 1.2rem; font-weight: bold; margin-top: 1.5rem; text-align: center; }
    #chart-container { margin-top: 2rem; }
    #graficoCalorias { height: 300px !important; }
    .btn-remove { background: transparent; color: red; cursor: pointer; border: none; font-size: 1rem; }
  </style>
</head>
<body>
  <header>
    Calculadora de Calorias – <span id="user-name">Ariana Mendes</span>
  </header>
  <div class="container" id="main"></div>
  <div class="total-diario">
    Total Diário: <span id="total-dia">0 kcal</span>
    <br>
    <button onclick="salvarDia()">Salvar Dia</button>
  </div>
  <div id="chart-container" class="container">
    <canvas id="graficoCalorias"></canvas>
    <br>
    <button onclick="resetarGrafico()">Resetar Gráfico</button>
  </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const nomeUsuario = "Ariana Mendes";
  document.getElementById("user-name").textContent = nomeUsuario;

  const alimentos = {
    "Melancia": 0.30, "Kiwi": 0.61, "Espinafre": 0.23, "Alface": 0.15,
    "Banana": 0.89, "Maçã": 0.52, "Laranja": 0.47, "Mamão": 0.45, "Abacate": 1.60,
    "Arroz branco": 1.30, "Arroz integral": 1.11, "Feijão preto": 1.34, "Batata doce": 0.86,
    "Frango grelhado": 1.65, "Peito de frango": 1.65, "Carne bovina": 2.50,
    "Ovo cozido": 1.43, "Ovo frito": 2.17, "Leite integral": 0.64,
    "Leite desnatado": 0.36, "Iogurte natural": 0.63, "Queijo mussarela": 3.20,
    "Pão francês": 2.65, "Pão integral": 2.50, "Bolo simples": 3.90,
    "Biscoito recheado": 4.80, "Chocolate ao leite": 5.30, "Amendoim": 5.67,
    "Chia": 4.86, "Linhaça": 5.34, "Azeite de oliva (1 colher sopa)": 1.19,
    "Manteiga (1 colher sopa)": 1.02, "Óleo de soja (1 colher sopa)": 1.20,
    "Bacon": 3.93, "Linguiça calabresa": 2.80,
    "Café preto sem açúcar (1 xícara)": 0.02, "Café com açúcar (1 xícara)": 0.20
  };

  const refeicoes = [
    "Café da manhã", "Refeição pós café", "Almoço",
    "Lanche da tarde", "Jantar", "Ceia da noite"
  ];

  function normalizar(str) {
    return str.normalize("NFD").replace(/\p{Diacritic}/gu, "").replace(/\s+/g, "-");
  }

  const main = document.getElementById("main");
  let dadosHistorico = JSON.parse(localStorage.getItem("calorias-historico") || "[]");
  let dadosHoje = JSON.parse(localStorage.getItem("refeicoes-hoje") || "{}");

  window.adicionar = function(ref) {
    const id = normalizar(ref);
    const sel = document.getElementById(`sel-${id}`);
    const qtdInput = document.getElementById(`qtd-${id}`);
    const qtd = parseFloat(qtdInput.value);
    if (!qtd || qtd <= 0) return;
    const alim = sel.value;
    const kcal = alimentos[alim] * qtd;
    if (!dadosHoje[ref]) dadosHoje[ref] = [];
    dadosHoje[ref].push({ alim, qtd, kcal });
    localStorage.setItem("refeicoes-hoje", JSON.stringify(dadosHoje));
    atualizarTabela(ref);
    atualizarTotal();
    qtdInput.value = "";
  }

  window.removerItem = function(ref, index) {
    dadosHoje[ref].splice(index, 1);
    localStorage.setItem("refeicoes-hoje", JSON.stringify(dadosHoje));
    atualizarTabela(ref);
    atualizarTotal();
  }

  function atualizarTabela(ref) {
    const id = normalizar(ref);
    const tbody = document.querySelector(`#tab-${id} tbody`);
    if (!tbody) return;
    tbody.innerHTML = "";
    let total = 0;
    (dadosHoje[ref] || []).forEach((item, index) => {
      total += item.kcal;
      tbody.innerHTML += `<tr><td>${item.alim}</td><td>${item.qtd}</td><td>${item.kcal.toFixed(2)}</td><td><button class='btn-remove' onclick="removerItem('${ref}', ${index})">×</button></td></tr>`;
    });
    const totalEl = document.getElementById(`total-${id}`);
    if (totalEl) totalEl.textContent = total.toFixed(2);
  }

  function atualizarTotal() {
    let total = 0;
    for (const ref in dadosHoje) {
      dadosHoje[ref].forEach(e => total += e.kcal);
    }
    document.getElementById("total-dia").textContent = total.toFixed(2) + " kcal";
  }

  window.salvarDia = function() {
    let total = 0;
    for (const ref in dadosHoje) {
      dadosHoje[ref].forEach(e => total += e.kcal);
    }
    const hoje = new Date().toISOString().split('T')[0];
    dadosHistorico.push({ dia: hoje, kcal: total });
    localStorage.setItem("calorias-historico", JSON.stringify(dadosHistorico));
    localStorage.removeItem("refeicoes-hoje");
    localStorage.setItem("ultima-salvaguarda", hoje);
    location.reload();
  }

  window.resetarGrafico = function() {
    if (confirm("Tem certeza que deseja apagar todo o histórico?")) {
      localStorage.removeItem("calorias-historico");
      location.reload();
    }
  }

  function desenharGrafico() {
    const ctx = document.getElementById('graficoCalorias').getContext('2d');
    const dias = dadosHistorico.map(e => e.dia);
    const valores = dadosHistorico.map(e => e.kcal);
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: dias,
        datasets: [{ label: 'Kcal consumidas', data: valores, backgroundColor: '#ff69b4' }]
      },
      options: {
        scales: { y: { beginAtZero: true } }
      }
    });
  }

  function salvarDiaAutomaticamenteSeForNovo() {
    const hoje = new Date().toISOString().split('T')[0];
    const salvo = localStorage.getItem("ultima-salvaguarda");
    if (salvo && salvo === hoje) return;
    salvarDia();
  }

  function checarViradaDoDia() {
    const agora = new Date();
    const proximaMeiaNoite = new Date();
    proximaMeiaNoite.setHours(24, 0, 0, 0);
    const tempoRestante = proximaMeiaNoite - agora;
    setTimeout(() => {
      salvarDiaAutomaticamenteSeForNovo();
      checarViradaDoDia();
    }, tempoRestante);
  }

  function renderizarRefeicoes() {
    refeicoes.forEach(ref => {
      const id = normalizar(ref);
      const sec = document.createElement('div');
      sec.className = 'meal-section';
      sec.innerHTML = `
        <div class="meal-title">${ref}</div>
        <div class="input-row">
          <select id="sel-${id}">
            ${Object.keys(alimentos).map(alim => `<option value="${alim}">${alim}</option>`).join('')}
          </select>
          <input id="qtd-${id}" type="number" min="0" step="0.1" placeholder="Qtd (100g)" />
          <button onclick="adicionar('${ref}')">Adicionar</button>
        </div>
        <table id="tab-${id}"><thead><tr><th>Alimento</th><th>Qtd</th><th>kcal</th><th></th></tr></thead><tbody></tbody><tfoot><tr><td colspan="2">Total</td><td id="total-${id}">0</td><td></td></tr></tfoot></table>
      `;
      main.appendChild(sec);
    });
  }

  renderizarRefeicoes();
  for (const ref in dadosHoje) atualizarTabela(ref);
  atualizarTotal();
  desenharGrafico();
  checarViradaDoDia();
});
</script>
</body>
</html>